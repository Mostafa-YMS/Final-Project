import React from "react";
import { useState } from "react";
import ReactMapGL, {
  NavigationControl,
  GeolocateControl,
  _MapContext as MapContext,
} from "react-map-gl";
import { Stations } from "../components";
import DeckGL from "@deck.gl/react";
import { MapView } from "@deck.gl/core";
import { PathLayer } from "@deck.gl/layers";
import { FlyToInterpolator } from "@deck.gl/core";

export const MainMap = (props) => {
  const MAPBOX_TOKEN =
    "pk.eyJ1IjoibW9oYW1lZGFtaW4wMDAwMCIsImEiOiJja3gwZnJiazkwczRhMnJwenduZ2ZkN2x6In0.HafaYHRDf0lGzVMq3k318w";

  const teleport = new FlyToInterpolator({ speed: 2 });

  const geolocateStyle = {
    top: 0,
    left: 0,
    margin: 10,
  };

  const positionOptions = { enableHighAccuracy: true };

  // const [viewport, setViewport] = useState({
  //   latitude: 30.0778,
  //   longitude: 31.2852,
  //   zoom: 1
  // })

  const data = [
    {
      path: [
        [31.18406,30.46249],
        [31.18527,30.46172],
        [31.18538,30.46189],
        [31.18526,30.46200],
        [31.18558,30.46250],
        [31.18570,30.46213],
        [31.18514,30.46128],
        [31.18512,30.46118],
        [31.18510,30.46096],
        [31.18508,30.46043],
        [31.18488,30.46004],
        [31.18470,30.45998],
        [31.18405,30.46023],
        [31.18375,30.46019],
        [31.18355,30.46011],
        [31.18185,30.45844],
        [31.18119,30.45820],
        [31.18116,30.45810],
        [31.18132,30.45515],
        [31.18156,30.45341],
        [31.18199,30.45229],
        [31.18213,30.45224],
        [31.18253,30.45154],
        [31.18203,30.45108],
        [31.18199,30.45083],
        [31.18228,30.44869],
        [31.18378,30.43913],
        [31.18469,30.43355],
        [31.18483,30.43324],
        [31.18561,30.42802],
        [31.18957,30.40445],
        [31.19124,30.39406],
        [31.19485,30.37212],
        [31.19507,30.37148],
        [31.19806,30.36400],
        [31.20414,30.35783],
        [31.20512,30.35622],
        [31.20530,30.35516],
        [31.20518,30.35382],
        [31.20503,30.35279],
        [31.20475,30.35108],
        [31.20455,30.34961],
        [31.20381,30.34774],
        [31.20061,30.34418],
        [31.20004,30.34314],
        [31.19987,30.34260],
        [31.19973,30.34157],
        [31.19973,30.34106],
        [31.20074,30.33461],
        [31.20472,30.30989],
        [31.20614,30.30221],
        [31.20678,30.30068],
        [31.20926,30.29759],
        [31.20976,30.29670],
        [31.21008,30.29535],
        [31.21003,30.29433],
        [31.20982,30.29360],
        [31.20868,30.29199],
        [31.20549,30.28982],
        [31.20351,30.28786],
        [31.20233,30.28588],
        [31.20142,30.28264],
        [31.20146,30.28061],
        [31.20163,30.27999],
        [31.20178,30.27918],
        [31.20456,30.27474],
        [31.20901,30.27083],
        [31.21035,30.26890],
        [31.21104,30.26699],
        [31.21242,30.25875],
        [31.21562,30.23870],
        [31.21801,30.22377],
        [31.21796,30.22346],
        [31.21902,30.21721],
        [31.21917,30.21667],
        [31.22080,30.20705],
        [31.22252,30.19604],
        [31.22220,30.19256],
        [31.22216,30.19066],
        [31.22395,30.17912],
        [31.22423,30.17836],
        [31.22551,30.17635],
        [31.22667,30.16997],
        [31.22952,30.15159],
        [31.22981,30.14915],
        [31.23006,30.14746],
        [31.23096,30.14306],
        [31.23146,30.14038],
        [31.23327,30.13597],
        [31.23817,30.12947],
        [31.23975,30.12745],
        [31.24259,30.12417],
        [31.24329,30.12281],
        [31.24360,30.12173],
        [31.24358,30.12127],
        [31.24276,30.11845],
        [31.24170,30.11660],
        [31.24129,30.11602],
        [31.24126,30.11587],
        [31.24300,30.11207],
        [31.24336,30.11116],
        [31.24370,30.10912],
        [31.24444,30.10658],
        [31.24466,30.10444],
        [31.24447,30.10407],
        [31.24231,30.10265],
        [31.24179,30.10233],
        [31.24072,30.10157],
        [31.24027,30.10119],
        [31.23925,30.09914],
        [31.23804,30.09698],
        [31.23612,30.09352],
        [31.23490,30.09115],
        [31.23411,30.08993],
        [31.23344,30.08807],
        [31.23314,30.08705],
        [31.23263,30.08559],
        [31.23189,30.08348],
        [31.23100,30.08173],
        [31.23080,30.08100],
        [31.23072,30.08004],
        [31.22959,30.07768],
        [31.22858,30.07579],
        [31.22755,30.07408],
        [31.22737,30.07346],
        [31.22683,30.06710],
        [31.22722,30.06564],
        [31.22718,30.06499],
        [31.22699,30.06355],
        [31.22736,30.06130],
        [31.22778,30.05977],
        [31.22859,30.05681],
        [31.22938,30.05463],
        [31.23063,30.05172],
        [31.23112,30.04992],
        [31.23131,30.04925],
        [31.23136,30.04885],
        [31.23152,30.04880],
        [31.23262,30.04881],
        [31.23324,30.04887],
        [31.23381,30.04871],
        [31.23416,30.04857],
        [31.23445,30.04831],
        [31.23452,30.04799],
        [31.23454,30.04659],
        [31.23496,30.04572],
        [31.23523,30.04525],
        [31.23536,30.04457],
        [31.23531,30.04434],
        [31.23542,30.04416]
      ],
      name: "Banha - Cairo",
      color: [255, 0, 0, 255],
    },
    {
      path: [
        [31.18406, 30.46249],
[31.18376,30.46262],
[31.18375,30.46269],
[31.18421,30.46327],
[31.18421,30.46329],
[31.18421,30.46329],
[31.18383,30.46358],
[31.18340,30.46377],
[31.18220,30.46390],
[31.18209,30.46393],
[31.18171,30.46433],
[31.17977,30.46628],
[31.17996,30.46669],
[31.18000,30.46683],
[31.17988,30.46841],
[31.17981,30.47040],
[31.17980,30.47047],
[31.17974,30.47050],
[31.17788,30.47048],
[31.17787,30.47056],
[31.17735,30.47056],
[31.17703,30.47065],
[31.17679,30.47064],
[31.17648,30.47058],
[31.17083,30.47052],
[31.17058,30.47055],
[31.16904,30.47130],
[31.16872,30.47171],
[31.16870,30.47172],
[31.16843,30.47253],
[31.16843,30.47254],
[31.16851,30.47318],
[31.17049,30.47872],
[31.17055,30.47877],
[31.17054,30.47881],
[31.17261,30.48242],
[31.17286,30.48333],
[31.17286,30.48436],
[31.17271,30.48507],
[31.17117,30.48809],
[31.17122,30.48816],
[31.17129,30.48820],
[31.17137,30.48818],
[31.17239,30.48758],
[31.17269,30.48748],
[31.17345,30.48850],
[31.17305,30.48851],
[31.17029,30.49022],
[31.16997,30.49049],
[31.16799,30.49485],
[31.16772,30.49548],
[31.16614,30.49840],
[31.16487,30.50038],
[31.16487,30.50038],
[31.14271,30.54296],
[31.14258,30.54333],
[31.14250,30.54399],
[31.14287,30.54733],
[31.14288,30.54796],
[31.14260,30.54891],
[31.14180,30.55007],
[31.14130,30.54968],
[31.14022,30.54922],
[31.13906,30.54879],
[31.13876,30.54890],
[31.13863,30.54891],
[31.13570,30.54877],
[31.13375,30.54867],
[31.13389,30.54634],
[31.13391,30.54622],
[31.13395,30.54585],
[31.13436,30.54588],
[31.13438,30.54566]
      ],
      name: "Banha - Qwysna",
      color: [255, 0, 0, 255],
    },
    {
      path: [
        [31.2454, 30.0805],
        [31.245, 30.071],
        [31.2425, 30.057],
        [31.2469, 30.0522],
        [31.2648, 30.0689],
      ],
      name: "Attaba - Rood el farag",
      color: [255, 0, 0, 255],
    },
  ];

  const layer = new PathLayer({
    id: "path-layer",
    data,
    pickable: true,
    widthScale: 1,
    widthMinPixels: 1,
    getPath: (d) => d.path,
    getColor: (d) => d.color,
    getWidth: (d) => 5,
  });

  return (
    <div
      style={{
        position: "absolute",
        display: "inline-block",
        width: 800,
        height: 800,
      }}
    >
      <DeckGL
        initialViewState={props.viewport}
        controller={true}
        layers={layer}
        ContextProvider={MapContext.Provider}
      >
        <MapView id="map" controller={true}>
          <ReactMapGL
            // {...viewport}
            onViewportChange={(nextViewport) => props.setViewport(nextViewport)}
            mapboxApiAccessToken={MAPBOX_TOKEN}
            mapStyle="mapbox://styles/mapbox/dark-v9"
            // mapStyle="mapbox://styles/mapbox/streets-v8"
          ></ReactMapGL>
        </MapView>

        <Stations />
        <GeolocateControl
          style={geolocateStyle}
          positionOptions={positionOptions}
          trackUserLocation
          auto = {props.auto}
        />
        <div style={{ position: "absolute", right: 30, top: 0, zIndex: 1 }}>
          <NavigationControl />
        </div>
      </DeckGL>
    </div>
  );
};
